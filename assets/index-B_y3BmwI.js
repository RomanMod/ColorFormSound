(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const It=1500,at=800,At=1450,Ge=30,Tt=100,Et=0,Lt=500,xt=500,he=5e3,Ae="plsound.wav",A={ru:{title:"–ù–∞–º–µ—Ä–µ–Ω–∏–µ –∏–ª–∏ –í–∏–¥–µ–Ω–∏–µ",playIntention:"–ò–≥—Ä–∞—Ç—å –≤ –ù–∞–º–µ—Ä–µ–Ω–∏–µ",playVision:"–ò–≥—Ä–∞—Ç—å –≤ –í–∏–¥–µ–Ω–∏–µ",readMore:"–ü—Ä–æ—á—Ç–∏",intentionTitle:"–ù–∞–º–µ—Ä–µ–Ω–∏–µ",visionTitle:"–í–∏–¥–µ–Ω–∏–µ",newGame:"–ù–æ–≤–∞—è –∏–≥—Ä–∞",showResult:"–ü–æ–∫–∞–∑–∞—Ç—å",shuffle:"–ü–µ—Ä–µ–º–µ—à–∞—Ç—å",back:"–ù–∞ —Å–µ–π—á–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ",readMoreTitle:"–û—Ç–ª–∏—á–∏–µ –ù–∞–º–µ—Ä–µ–Ω–∏—è –∏ –í–∏–¥–µ–Ω–∏—è",readMoreText1:"–í –∏–≥—Ä–µ ¬´–í–∏–¥–µ–Ω–∏–µ¬ª –∑–∞ —á–µ—Ä–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ–±—ä–µ–∫—Ç. –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–º–µ—à–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã, –Ω–∞–∂–∞–≤ –Ω–∞ —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω. –ß–µ—Ä–µ–∑ —Ç—Ä–∏ —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è. –ó–∞–¥–∞—á–∞ ‚Äî –≤ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ —Å–∫—Ä—ã—Ç–æ –∑–∞ —à–∏—Ä–º–æ–π, –∏ –Ω–∞–∂–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É. –ü–µ—Ä–µ–¥ –≤—ã–±–æ—Ä–æ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã.",readMoreText2:"–í –∏–≥—Ä–µ ¬´–ù–∞–º–µ—Ä–µ–Ω–∏–µ¬ª –∑–∞ —á–µ—Ä–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤. –ó–∞–¥–∞—á–∞ ‚Äî –≤ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –∏ –Ω–∞–∂–∞—Ç—å –Ω–∞ —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –∏–ª–∏ –∫–Ω–æ–ø–∫—É ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª. –í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Ü–∏–∫–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è. –ü–æ–∫–∞–∑–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç —Å–æ–≤–ø–∞—Å—Ç—å —Å –≤–∞—à–∏–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –≤–∑–æ—Ä–æ–º.",closeReadMore:"–ó–∞–∫—Ä—ã—Ç—å",themeDay:"–î–µ–Ω—å",themeNight:"–ù–æ—á—å",themeToggle:"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É",success:"–£–≥–∞–¥–∞–ª",failure:"–ù–µ —É–≥–∞–¥–∞–ª",color:"–¶–≤–µ—Ç",shape:"–§–∏–≥—É—Ä–∞",soundMode:"–ó–≤—É–∫",limited:"10 –ø–æ–ø—ã—Ç–æ–∫",unlimited:"–ë–µ–∑–ª–∏–º–∏—Ç",statsAttempts:"–ü–æ–ø—ã—Ç–∫–∏",statsSuccesses:"–£—Å–ø–µ—Ö–∏",statsFailures:"–ù–µ–≤–¥–∞—á–∏",statsSuccessRate:"–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞",statsAvgTime:"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è",statsLastAttemptTimeLabel:"–í—Ä–µ–º—è –Ω–∞ –ø–æ–ø—ã—Ç–∫—É",statsHistoryLabel:"–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞:",visionSuccess:"–£—Å–ø–µ—Ö!",visionFailure:"–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!",greeting:"–ü–æ—Ä–µ–ø–µ—Ç–∏—Ä—É–µ–º",defaultUserName:"–ò–≥—Ä–æ–∫",altSoundWave:"–ó–≤—É–∫–æ–≤–∞—è –≤–æ–ª–Ω–∞",altSilence:"–¢–∏—à–∏–Ω–∞",chooseSoundOn:"–í—ã–±—Ä–∞—Ç—å –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω",chooseSoundOff:"–í—ã–±—Ä–∞—Ç—å –∑–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω"},uk:{title:"–ù–∞–º—ñ—Ä —á–∏ –ë–∞—á–µ–Ω–Ω—è",playIntention:"–ì—Ä–∞—Ç–∏ –≤ –ù–∞–º—ñ—Ä",playVision:"–ì—Ä–∞—Ç–∏ –≤ –ë–∞—á–µ–Ω–Ω—è",readMore:"–ü—Ä–æ—á–∏—Ç–∞–π",intentionTitle:"–ù–∞–º—ñ—Ä",visionTitle:"–ë–∞—á–µ–Ω–Ω—è",newGame:"–ù–æ–≤–∞ –≥—Ä–∞",showResult:"–ü–æ–∫–∞–∑–∞—Ç–∏",shuffle:"–ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏",back:"–ù–∞—Ä–∞–∑—ñ –¥–æ—Å–∏—Ç—å",readMoreTitle:"–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –ù–∞–º—ñ—Ä—É —Ç–∞ –ë–∞—á–µ–Ω–Ω—è",readMoreText1:"–£ –≥—Ä—ñ ¬´–ë–∞—á–µ–Ω–Ω—è¬ª –∑–∞ —á–æ—Ä–Ω–∏–º –µ–∫—Ä–∞–Ω–æ–º –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –æ–±‚Äô—î–∫—Ç. –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–º—ñ—à–∞–π—Ç–µ –æ–±‚Äô—î–∫—Ç–∏, –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ –Ω–∞ —á–æ—Ä–Ω–∏–π –µ—Ä–∞–Ω. –ß–µ—Ä–µ–∑ —Ç—Ä–∏ —Å–µ–∫—É–Ω–¥–∏ –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è. –ó–∞–≤–¥–∞–Ω–Ω—è ‚Äî —É—è–≤–∏—Ç–∏, —â–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ –∑–∞ —à–∏—Ä–º–æ—é, —ñ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∫–Ω–æ–ø–∫—É. –ü–µ—Ä–µ–¥ –≤–∏–±–æ—Ä–æ–º –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –ø–µ—Ä–µ–º—ñ—à—É–π—Ç–µ –æ–±‚Äô—î–∫—Ç–∏.",readMoreText2:"–£ –≥—Ä—ñ ¬´–ù–∞–º—ñ—Ä¬ª –∑–∞ —á–æ—Ä–Ω–∏–º –µ–∫—Ä–∞–Ω–æ–º –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ü–∏–∫–ª—ñ—á–Ω–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ –æ–±‚Äô—î–∫—Ç—ñ–≤. –ó–∞–≤–¥–∞–Ω–Ω—è ‚Äî —É—è–≤–∏—Ç–∏ –æ–±‚Äô—î–∫—Ç —ñ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –Ω–∞ —á–æ—Ä–Ω–∏–π –µ—Ä–∞–Ω –∞–±–æ –∫–Ω–æ–ø–∫—É ¬´–ü–æ–∫–∞–∑–∞—Ç–∏¬ª. –£ —Ü–µ–π –º–æ–º–µ–Ω—Ç —Ü–∏–∫–ª –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è. –ü–æ–∫–∞–∑–∞–Ω–∏–π –æ–±‚Äô—î–∫—Ç –º–æ–∂–µ –∑–±—ñ–≥—Ç–∏—Å—è –∑ –≤–∞—à–∏–º –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–º –±–∞—á–µ–Ω–Ω—è–º.",closeReadMore:"–ó–∞–∫—Ä–∏—Ç–∏",themeDay:"–î–µ–Ω—å",themeNight:"–ù—ñ—á",themeToggle:"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏ —Ç–µ–º—É",success:"–í–≥–∞–¥–∞–≤",failure:"–ù–µ –≤–≥–∞–¥–∞–≤",color:"–ö–æ–ª—ñ—Ä",shape:"–§—ñ–≥—É—Ä–∞",soundMode:"–ó–≤—É–∫",limited:"10 —Å–ø—Ä–æ–±",unlimited:"–ë–µ–∑–ª—ñ–º—ñ—Ç",statsAttempts:"–°–ø—Ä–æ–±–∏",statsSuccesses:"–£—Å–ø—ñ—Ö–∏",statsFailures:"–ù–µ–≤–¥–∞—á—ñ",statsSuccessRate:"–í—ñ–¥—Å–æ—Ç–æ–∫ —É—Å–ø—ñ—Ö—É",statsAvgTime:"–°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å",statsLastAttemptTimeLabel:"–ß–∞—Å –Ω–∞ —Å–ø—Ä–æ–±—É",statsHistoryLabel:"–Ü—Å—Ç–æ—Ä—ñ—è —É—Å–ø—ñ—Ö—É:",visionSuccess:"–£—Å–ø—ñ—Ö!",visionFailure:"–°–ø—Ä–æ–±—É–π —â–µ!",greeting:"–ü–æ—Ä–µ–ø–µ—Ç–∏—Ä—É—î–º–æ",defaultUserName:"–ì—Ä–∞–≤–µ—Ü—å",altSoundWave:"–ó–≤—É–∫–æ–≤–∞ —Ö–≤–∏–ª—è",altSilence:"–¢–∏—à–∞",chooseSoundOn:"–û–±—Ä–∞—Ç–∏ –∑–≤—É–∫ —É–≤—ñ–º–∫–Ω–µ–Ω–æ",chooseSoundOff:"–û–±—Ä–∞—Ç–∏ –∑–≤—É–∫ –≤–∏–º–∫–Ω–µ–Ω–æ"},en:{title:"Intention or Vision",playIntention:"Play Intention",playVision:"Play Vision",readMore:"Read More",intentionTitle:"Intention",visionTitle:"Vision",newGame:"New Game",showResult:"Show",shuffle:"Shuffle",back:"Enough for Now",readMoreTitle:"Difference Between Intention and Vision",readMoreText1:'In the "Vision" game, an object is hidden behind a black screen. First, shuffle the objects by clicking the black screen. After three seconds, the shuffling stops. Your task is to imagine what is hidden behind the screen and press the corresponding button. You must shuffle the objects before making a choice.',readMoreText2:'In the "Intention" game, objects are cycled behind a black screen. Your task is to mentally fixate on an object and click the black screen or the "Show" button. At that moment, the cycle stops. The revealed object may match your mental image.',closeReadMore:"Close",themeDay:"Day",themeNight:"Night",themeToggle:"Toggle Theme",success:"Guessed",failure:"Not Guessed",color:"Color",shape:"Shape",soundMode:"Sound",limited:"10 Attempts",unlimited:"Unlimited",statsAttempts:"Attempts",statsSuccesses:"Successes",statsFailures:"Failures",statsSuccessRate:"Success Rate",statsAvgTime:"Average Time",statsLastAttemptTimeLabel:"Time per Attempt",statsHistoryLabel:"Success History:",visionSuccess:"Success!",visionFailure:"Try Again!",greeting:"Let's practice",defaultUserName:"Player",altSoundWave:"Sound wave",altSilence:"Silence",chooseSoundOn:"Choose sound on",chooseSoundOff:"Choose sound off"},es:{title:"Intenci√≥n o Visi√≥n",playIntention:"Jugar a Intenci√≥n",playVision:"Jugar a Visi√≥n",readMore:"Leer M√°s",intentionTitle:"Intenci√≥n",visionTitle:"Visi√≥n",newGame:"Nuevo Juego",showResult:"Mostrar",shuffle:"Mezclar",back:"Suficiente por Ahora",readMoreTitle:"Diferencia entre Intenci√≥n y Visi√≥n",readMoreText1:'En el juego "Visi√≥n", un objeto est√° oculto detr√°s de una pantalla negra. Primero, mezcla los objetos haciendo clic en la pantalla negra. Despu√©s de tres segundos, la mezcla se detiene. Tu tarea es imaginar qu√© est√° oculto detr√°s de la pantalla y presionar el bot√≥n correspondiente. Debes mezclar los objetos antes de elegir.',readMoreText2:'En el juego "Intenci√≥n", los objetos se ciclan detr√°s de una pantalla negra. Tu tarea es fijar mentalmente un objeto y hacer clic en la pantalla negra o en el bot√≥n "Mostrar". En ese momento, el ciclo se detiene. El objeto revelado puede coincidir con tu imagen mental.',closeReadMore:"Cerrar",themeDay:"D√≠a",themeNight:"Noche",themeToggle:"Cambiar Tema",success:"Adivinado",failure:"No Adivinado",color:"Color",shape:"Forma",soundMode:"Sonido",limited:"10 Intentos",unlimited:"Ilimitado",statsAttempts:"Intentos",statsSuccesses:"√âxitos",statsFailures:"Fracasos",statsSuccessRate:"Tasa de √âxito",statsAvgTime:"Tiempo Promedio",statsLastAttemptTimeLabel:"Tiempo por Intento",statsHistoryLabel:"Historial de √âxitos:",visionSuccess:"¬°√âxito!",visionFailure:"¬°Intenta de Nuevo!",greeting:"Practiquemos",defaultUserName:"Jugador",altSoundWave:"Onda de sonido",altSilence:"Silencio",chooseSoundOn:"Elegir sonido activado",chooseSoundOff:"Elegir sonido desactivado"},alien:{title:"‚ñ≥‚óà‚ñ∑",playIntention:"‚ä∏‚óâ",playVision:"‚ä∏‚ó¨",readMore:"‚óá",intentionTitle:"‚óâ",visionTitle:"‚ó¨",newGame:"‚Ü∫",showResult:"‚óâ",shuffle:"‚Üª",back:"‚üø",readMoreTitle:"‚óâ‚ó¨",readMoreText1:"‚ó¨‚ä∏|‚ñ•|‚äπ|‚Üª‚ñ•‚Üí3‚ä∏‚Üí‚äπ|‚äπ|‚óà‚ñ•‚Üí‚ä∏|‚äπ|‚Üª",readMoreText2:"‚óâ‚ä∏|‚Ü∫‚ñ•|‚äπ|‚óà‚ä∏‚Üí‚ñ•/‚óâ|‚äπ|‚äπ‚Ü∫|‚äπ|‚ñ•=‚óà",closeReadMore:"‚ä∑",themeDay:"‚óç",themeNight:"‚óå",themeToggle:"‚ä∏‚óç‚óå",success:"‚ä∏",failure:"‚äπ",color:"‚óº|‚äπ",shape:"‚óª|‚äπ",soundMode:"‚àÆ",limited:"‚ä∏‚ä∏|‚äπ",unlimited:"‚Ü∫|‚äπ",statsAttempts:"‚Ü∫|‚äπ",statsSuccesses:"‚ä∏",statsFailures:"‚äπ",statsSuccessRate:"%‚ä∏",statsAvgTime:"‚ä∏‚äπ",statsLastAttemptTimeLabel:"‚è≤Ô∏è",statsHistoryLabel:"üìú",visionSuccess:"‚ä∏‚ó¨",visionFailure:"‚Ü∫‚ó¨",greeting:"‚ä∏‚óá",defaultUserName:"‚ä∏–ò–≥—Ä–æ–∫‚äπ",altSoundWave:"‚àÆ‚àº",altSilence:"‚àÆ‚Äî",chooseSoundOn:"‚àÆ‚àº‚äï",chooseSoundOff:"‚àÆ‚Äî‚äñ"}};let g="uk";const lt={ru:"RU",uk:"UK",en:"EN",es:"ES",alien:"üëΩ"};function rt(){const e=A[g];document.querySelector("#menu-screen h1").textContent=e.title,document.getElementById("btn-start-intention").textContent=e.playIntention,document.getElementById("btn-start-vision").textContent=e.playVision,document.getElementById("btn-read-more").textContent=e.readMore,document.getElementById("game-intention").querySelector("h2").textContent=e.intentionTitle,document.getElementById("game-vision").querySelector("h2").textContent=e.visionTitle,document.getElementById("intention-new-game-btn").textContent=e.newGame,document.getElementById("vision-new-game-btn").textContent=e.newGame,document.getElementById("intention-show-btn").textContent=e.showResult,document.getElementById("vision-shuffle-btn").textContent=e.shuffle,document.querySelectorAll(".back-btn").forEach(c=>c.textContent=e.back);const t=document.getElementById("read-more-area");t&&(t.querySelector("h3").textContent=e.readMoreTitle,t.querySelectorAll("p")[0].textContent=e.readMoreText1,t.querySelectorAll("p")[1].textContent=e.readMoreText2),document.getElementById("btn-close-read-more").textContent=e.closeReadMore;const o=document.body.classList.contains("light-theme")?e.themeDay:e.themeNight,s=document.getElementById("theme-text");s&&(s.textContent=o),document.getElementById("theme-icon").textContent=document.body.classList.contains("light-theme")?"‚òÄÔ∏è":"üåô",document.getElementById("theme-toggle-btn").setAttribute("aria-label",`${e.themeToggle}: ${o}`);const a=document.getElementById("language-toggle-btn"),i=document.getElementById("language-text");a&&i&&(i.textContent=lt[g],a.setAttribute("aria-label",`${e.themeToggle.replace("—Ç–µ–º—É","–º–æ–≤—É")}: ${lt[g]}`)),document.querySelectorAll(".language-option").forEach(c=>{c.classList.remove("active"),c.setAttribute("aria-selected","false"),c.dataset.lang===g&&(c.classList.add("active"),c.setAttribute("aria-selected","true"))}),document.querySelector('label[for="intention-mode-color"]').childNodes[1].textContent=` ${e.color}`,document.querySelector('label[for="intention-mode-shape"]').childNodes[1].textContent=` ${e.shape}`,document.querySelector('label[for="intention-mode-sound"]').childNodes[1].textContent=` ${e.soundMode}`,document.querySelector('label[for="vision-mode-color"]').childNodes[1].textContent=` ${e.color}`,document.querySelector('label[for="vision-mode-shape"]').childNodes[1].textContent=` ${e.shape}`,document.querySelector('label[for="vision-mode-sound"]').childNodes[1].textContent=` ${e.soundMode}`,document.querySelector('label[for="intention-attempts-limited"]').childNodes[1].textContent=` ${e.limited}`,document.querySelector('label[for="intention-attempts-unlimited"]').childNodes[1].textContent=` ${e.unlimited}`,document.querySelector('label[for="vision-attempts-limited"]').childNodes[1].textContent=` ${e.limited}`,document.querySelector('label[for="vision-attempts-unlimited"]').childNodes[1].textContent=` ${e.unlimited}`;const p=document.getElementById("intention-stats");p&&p.querySelectorAll("p > span[data-translate-key]").forEach(c=>{const C=c.dataset.translateKey;e[C]&&(c.textContent=e[C])});const q=document.getElementById("vision-stats");q&&q.querySelectorAll("p > span[data-translate-key]").forEach(c=>{const C=c.dataset.translateKey;e[C]&&(c.textContent=e[C])}),re.querySelectorAll("button")[0].textContent=e.success,re.querySelectorAll("button")[1].textContent=e.failure;const T=document.querySelector("#vision-result p");T&&(T.textContent=T.textContent.includes("–£—Å–ø–µ—Ö")||T.textContent.includes("–£—Å–ø—ñ—Ö")?e.visionSuccess:e.visionFailure);const f=document.getElementById("greeting-text-part");f&&(f.textContent=e.greeting);const h=document.getElementById("telegram-user-name");!D||!D.first_name?h&&(h.textContent=e.defaultUserName):h&&(h.textContent=D.first_name),document.getElementById("btn-start-intention").setAttribute("aria-label",e.playIntention),document.getElementById("btn-start-vision").setAttribute("aria-label",e.playVision),document.getElementById("btn-read-more").setAttribute("aria-label",e.readMore),document.getElementById("intention-new-game-btn").setAttribute("aria-label",`${e.newGame} ${e.intentionTitle}`),document.getElementById("vision-new-game-btn").setAttribute("aria-label",`${e.newGame} ${e.visionTitle}`),document.getElementById("intention-show-btn").setAttribute("aria-label",e.showResult),document.getElementById("vision-shuffle-btn").setAttribute("aria-label",e.shuffle),document.querySelectorAll(".back-btn").forEach(c=>c.setAttribute("aria-label",e.back)),document.getElementById("btn-close-read-more").setAttribute("aria-label",e.closeReadMore),document.querySelector('.color-btn[data-choice="red"]').setAttribute("aria-label",`${e.color} –ß–µ—Ä–≤–æ–Ω–∏–π`),document.querySelector('.color-btn[data-choice="blue"]').setAttribute("aria-label",`${e.color} –°–∏–Ω—ñ–π`),document.querySelector('.shape-btn[data-choice="circle"]').setAttribute("aria-label",`${e.shape} –ö–æ–ª–æ`),document.querySelector('.shape-btn[data-choice="triangle"]').setAttribute("aria-label",`${e.shape} –¢—Ä–∏–∫—É—Ç–Ω–∏–∫`),document.querySelector('.sound-btn[data-choice="sound_on"]').setAttribute("aria-label",e.chooseSoundOn),document.querySelector('.sound-btn[data-choice="sound_off"]').setAttribute("aria-label",e.chooseSoundOff),t&&(g==="alien"?(t.classList.add("alien-text"),document.body.classList.add("alien-language")):(t.classList.remove("alien-text"),document.body.classList.remove("alien-language"))),M.svgOscilloscopeWave&&M.svgOscilloscopeWave.setAttribute("aria-label",e.altSoundWave),M.svgSilenceLine&&M.svgSilenceLine.setAttribute("aria-label",e.altSilence),te(),de()}window.appSessionId=`${Date.now()}${Math.random().toString(36).slice(2)}`;window.userId="anonymous_"+Math.random().toString(36).slice(2,9);window.currentSubsessionId=`${window.appSessionId}_0`;let dt=0,D=null,S="menu",b=null,P=null,X=null,$=!1,ct=0,_e=[];const ht=new Set;let w=null,x=null,Z=null,j=null,Y=null,V=null,L="color",be="limited",nt=10,W=!1;const v={attempts:0,successes:0,failures:0};let ee=[];const R=[];let me=0,Ie=null,F=null,N="color",ve="limited",st=10;const E={attempts:0,successes:0,failures:0};let Se=[];const z=[];let pe,Te,ce,Ne,Q,ne,$e,Ee,O,B,u,_,ie,ue,ke,Oe,Ve,We,Ue,ze,je,He,Pe,Le,d,k,r,y,I,oe,ge,fe,J,Je,Ke,Ye,Xe,Ze,Qe,et,tt,De,Re,Fe,se,G,U,ae,bt;function ut(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("width","100"),t.setAttribute("height","100"),t.setAttribute("viewBox","0 0 100 100"),e==="circle"){const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx","50"),o.setAttribute("cy","50"),o.setAttribute("r","40"),t.appendChild(o)}else if(e==="triangle"){const o=document.createElementNS("http://www.w3.org/2000/svg","polygon");o.setAttribute("points","50,10 90,90 10,90"),t.appendChild(o)}return t}function Ct(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 100 50"),e.setAttribute("aria-label",A[g].altSilence);const t=document.createElementNS("http://www.w3.org/2000/svg","line");return t.setAttribute("x1","5"),t.setAttribute("y1","25"),t.setAttribute("x2","95"),t.setAttribute("y2","25"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","3"),t.setAttribute("stroke-linecap","round"),e.appendChild(t),e}function Bt(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 100 50"),e.setAttribute("aria-label",A[g].altSoundWave);const t=12,o=5,s=2,a=45,i=5,l=[.3,.6,.9,.7,.4,.2,.5,.8,1,.75,.5,.25],q=(100-t*o)/(t-1),f=(100-(t*o+(t-1)*q))/2;for(let h=0;h<t;h++){const c=i+l[h%l.length]*(a-i),C=document.createElementNS("http://www.w3.org/2000/svg","rect"),_t=f+h*(o+q);C.setAttribute("x",String(_t)),C.setAttribute("y",String((50-c)/2)),C.setAttribute("width",String(o)),C.setAttribute("height",String(c)),C.setAttribute("fill","currentColor"),C.setAttribute("rx",String(s)),C.setAttribute("ry",String(s)),e.appendChild(C)}return e}const M={colorBlock:document.createElement("div"),svgCircle:ut("circle"),svgTriangle:ut("triangle"),svgOscilloscopeWave:Bt(),svgSilenceLine:Ct()};M.colorBlock.style.width="100%";M.colorBlock.style.height="100%";function Mt(){if(J&&J.length===2){const e=M.svgOscilloscopeWave.cloneNode(!0),t=M.svgSilenceLine.cloneNode(!0);J[0].innerHTML="",J[1].innerHTML="",J[0].appendChild(e),J[1].appendChild(t)}}const re=document.createElement("div");re.className="feedback-buttons";const it=document.createElement("button");it.textContent=A[g].success;it.className="small-btn";const ot=document.createElement("button");ot.textContent=A[g].failure;ot.className="small-btn";re.appendChild(it);re.appendChild(ot);function ye(){dt++;const e=`${window.appSessionId}_${dt}`;return window.currentSubsessionId=e,n(`Generated subsession_id: ${e}`),e}function n(...e){console.log(...e)}function Nt(){return navigator.onLine}function m(e,t){if(!e||!t)return console.error("Invalid eventName or params:",{eventName:e,params:t}),!1;const o=window.currentSubsessionId||`temp_${Date.now()}_${Math.random().toString(36).slice(2,5)}`,s={...t,subsession_id:t.subsession_id||o,app_session_id:window.appSessionId,custom_user_id:D?String(D.id):window.userId};if(!t.subsession_id&&(e.includes("intention")||e==="randomizer_start"||e==="mode_change"||e==="display_click"||e==="game_select"||e==="show_result"||e==="game_exit")&&n(`subsession_id was undefined for ${e}, used: ${s.subsession_id}`),!Nt())return n(`No internet connection, saving ${e} to localStorage`),qe(e,s),!1;try{return typeof gtag=="function"?(gtag("event",e,s),n(`gtag ${e} sent:`,s),!0):(console.warn("gtag function not available. Event not sent:",e,s),qe(e,s),!1)}catch(a){return console.error(`gtag ${e} failed:`,a),qe(e,s),!1}}function qe(e,t){const o=e.includes("vision")?"visionStats":"intentionStats";let s=[];try{const a=localStorage.getItem(o);a&&(s=JSON.parse(a))}catch(a){console.error(`Error parsing ${o} from localStorage, resetting.`,a),s=[]}s.push({eventName:e,params:t,appSessionId:window.appSessionId,timestamp:Date.now()});try{localStorage.setItem(o,JSON.stringify(s)),n(`Saved ${e} to localStorage:`,t)}catch(a){console.error(`Error saving ${o} to localStorage.`,a)}}function le(e){const t=e==="intention"?"intentionAttempts":"visionAttempts",o=e==="intention"?R:z;try{localStorage.setItem(t,JSON.stringify(o)),n(`Saved ${e} attempts to localStorage:`,o)}catch(s){console.error(`Error saving ${t} to localStorage.`,s)}}function $t(){ee.length>0&&(_e.push({subsessionId:window.currentSubsessionId,sequence:[...ee],attempts:v.attempts,successes:v.successes,failures:v.failures}),n("Saved subsession sequence:",_e[_e.length-1]))}function K(){if(!b||S==="menu"||$){n("sendSessionSummary skipped:",{gameStartTime:b,currentGameMode:S,sessionSummarySent:$});return}if(S==="vision"&&E.attempts===0){n("No vision attempts, skipping sendSessionSummary");return}if(S==="intention"&&v.attempts===0){n("No intention attempts, skipping sendSessionSummary");return}const e=((Date.now()-b)/1e3).toFixed(1),t=S==="vision"?"game_session_summary":"intention_session_summary",o=S==="vision"?"Vision":"Intention",s=S==="vision"?E:v,a=S==="vision"?N:L,i=S==="vision"?Se:ee,l=document.body.classList.contains("light-theme")?"light":"dark",p=S==="vision"?ve:be,q={event_category:"Game",event_label:o,attempts:s.attempts,successes:s.successes,failures:s.failures,mode:a,session_duration_seconds:parseFloat(e),session_start_time:Math.floor(b),win_sequence:i.join(",")||"none",subsession_id:window.currentSubsessionId,theme_change:l,session_attempts_mode:p};n(`Sending ${t} with win_sequence: [${i.join(", ")}], theme: ${l}, attempts_mode: ${p}`,q),m(t,q)?($=!0,S==="intention"&&$t(),le(S)):n("sendSessionSummary failed, saved to localStorage")}function vt(){["visionStats","intentionStats"].forEach(e=>{let t=[];try{const s=localStorage.getItem(e);s&&(t=JSON.parse(s))}catch(s){console.error(`Error parsing ${e} from localStorage during sendSavedStats, resetting.`,s),t=[];try{localStorage.removeItem(e)}catch(a){console.error(`Failed to remove corrupted ${e}`,a)}}if(!Array.isArray(t)||t.length===0)return;n(`Found ${t.length} saved stats in ${e}`);const o=[];if(t.forEach((s,a)=>{n(`Sending saved ${s.eventName}:`,s.params),m(s.eventName,s.params)?(n(`Successfully sent saved ${s.eventName}`),o.push(a)):n(`Failed to send saved ${s.eventName}, keeping in localStorage`)}),o.length>0){const s=t.filter((a,i)=>!o.includes(i));if(s.length===0){try{localStorage.removeItem(e)}catch(a){console.error(`Failed to remove ${e}`,a)}n(`Cleared ${e} from localStorage`)}else{try{localStorage.setItem(e,JSON.stringify(s))}catch(a){console.error(`Failed to update ${e}`,a)}n(`Retaining ${s.length} items in ${e} in localStorage due to failed sends`)}}})}function we(e){n("Showing screen:",e,"current subsessionId:",window.currentSubsessionId),document.querySelectorAll(".game-screen").forEach(o=>o.classList.add("hidden")),pe&&(e==="game-intention"||e==="game-vision"?pe.classList.add("hidden"):pe.classList.remove("hidden")),e!=="game-intention"&&(Me(),w&&(clearTimeout(w),w=null)),e!=="game-vision"&&wt(),e==="menu-screen"?(K(),Te&&Te.classList.remove("hidden"),S="menu",b=null,typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.MainButton.hide(),ne&&ne.classList.add("hidden"),Q&&Q.classList.remove("hidden"),U&&U.classList.add("hidden"),G&&G.setAttribute("aria-expanded","false"),n("Returned to menu"),n("Intention subsession sequences:",_e),n(`Vision guess sequence: [${Se.join(", ")}]`)):e==="game-intention"?(Ee&&Ee.classList.remove("hidden"),S="intention",te(),_&&_.classList.add("hidden"),ie&&ie.classList.remove("hidden"),typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.MainButton.hide(),Y===null?Be("showScreen"):n("Intention randomizer already active, skipping startIntentionGame")):e==="game-vision"&&(Le&&Le.classList.remove("hidden"),S="vision",Ce(),de(),d&&(d.disabled=!1,d.classList.remove("hidden")),y&&y.classList.remove("hidden"),I&&I.classList.add("hidden"),oe&&oe.classList.remove("hidden"),H(!1),r&&r.classList.add("hidden"),k&&(k.style.backgroundColor="black"),r&&(r.style.backgroundColor="transparent"),F=null,X=null,ye())}function St(e){const t=Math.random();return n(`getRandomResult: mode=${e}, randomValue=${t}`),e==="color"?t>.5?"red":"blue":e==="shape"?t>.5?"circle":"triangle":e==="sound"?t>.5?"sound_on":"sound_off":null}async function xe(e){if(!Z)try{Z=new(window.AudioContext||window.webkitAudioContext)}catch(t){console.error("Web Audio API is not supported in this browser",t),m("error",{event_category:"App",event_label:"Audio Error",error_message:"Web Audio API not supported",subsession_id:window.currentSubsessionId});return}if(!j)try{n("Attempting to load sound:",e);const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status} while fetching ${e}`);const o=await t.arrayBuffer();j=await new Promise((s,a)=>{Z.decodeAudioData(o,s,a)}),n("Sound loaded successfully:",e)}catch(t){console.error("Error loading sound:",t),m("error",{event_category:"App",event_label:"Audio Load Error",error_message:`Failed to load ${e}: ${t.message}`,subsession_id:window.currentSubsessionId}),j=null}}function yt(){if(!j){n("Sound buffer not loaded, cannot play sound."),(L==="sound"||N==="sound")&&!j&&xe(Ae).then(()=>{j&&mt()});return}mt()}function mt(){!Z||!j||(Z.state==="suspended"?Z.resume().then(()=>{n("AudioContext resumed."),gt()}).catch(e=>console.error("Error resuming AudioContext:",e)):gt())}function gt(){if(!Z||!j)return;const e=Z.createBufferSource();e.buffer=j,e.connect(Z.destination),e.start(0),n("Playing sound")}function ft(){n(`Resetting Intention game, current subsessionId: ${window.currentSubsessionId}`),v.attempts>0&&!$&&K(),w&&(clearTimeout(w),w=null),v.attempts=0,v.successes=0,v.failures=0,ee=[],R.length=0,P=null,me=0,b=null,ye(),ht.clear(),Me(),Be("resetIntentionGame"),te(),u&&(u.disabled=!1,u.classList.remove("hidden")),_&&_.classList.add("hidden"),ie&&ie.classList.remove("hidden"),$=!1,n("Intention game reset, new subsession_id:",window.currentSubsessionId)}function pt(){n("Resetting Vision game"),E.attempts>0&&!$&&K(),x&&(clearTimeout(x),x=null),E.attempts=0,E.successes=0,E.failures=0,Se=[],z.length=0,wt(),ye(),de(),d&&(d.disabled=!1,d.classList.remove("hidden")),y&&y.classList.remove("hidden"),I&&I.classList.add("hidden"),oe&&oe.classList.remove("hidden"),H(!1),r&&r.classList.add("hidden"),k&&(k.style.backgroundColor="black"),r&&(r.style.backgroundColor="transparent"),F=null,X=null,$=!1,Ce(),n("Vision game reset, new subsession_id:",window.currentSubsessionId)}function Be(e="unknown"){if(n(`startIntentionGame called by: ${e}`),Y!==null){n("Intention randomizer already running, skipping start");return}(!window.currentSubsessionId||e==="resetIntentionGame"||e==="modeChange")&&ye(),n(`Starting intention game, mode: ${L} attempt_start_time: ${Date.now()} subsession_id: ${window.currentSubsessionId}`),P=Date.now(),me=0,L==="sound"&&(j||xe(Ae));const t=5*60*1e3;let o=null;function s(){const a=Ge+Math.random()*(Tt-Ge);me++,me%10===0&&n(`Randomizer updated (count: ${me}), next update in ${a.toFixed(2)}ms`),Y=window.setTimeout(s,a),o&&clearTimeout(o),o=window.setTimeout(()=>{n("Inactivity timeout, stopping intention randomizer"),Me()},t)}s(),m("randomizer_start",{event_category:"Game",event_label:"Intention Randomizer",mode:L,subsession_id:window.currentSubsessionId}),ht.add(window.currentSubsessionId),n(`randomizer_start event sent for subsession_id: ${window.currentSubsessionId}`),u&&u.classList.remove("hidden"),B&&B.classList.add("hidden"),O&&(O.style.backgroundColor="black")}function Me(){n(`Stopping Intention game, current subsessionId: ${window.currentSubsessionId}`),Y!==null&&(clearTimeout(Y),Y=null,n("Intention randomizer stopped")),w&&(clearTimeout(w),w=null),B&&B.classList.add("hidden"),O&&(O.style.backgroundColor="black"),P=null,V=null}function kt(){const e=Date.now(),t=e-ct;if(S!=="intention"||W||t<xt){n("showIntentionResult throttled or invalid state:",{timeSinceLast:t,gameMode:S,currentResult:V,isProcessing:W});return}ct=e,W=!0;const o=Et+Math.random()*(Lt-Ge);n(`Fixation delay: ${o.toFixed(2)}ms`),setTimeout(()=>{requestAnimationFrame(()=>{if(V=St(L),n("Showing intention result, mode:",L,"result:",V,"subsession_id:",window.currentSubsessionId),n(`Intention result displayed at: ${Date.now()}`),v.attempts++,v.attempts===1&&ie&&ie.classList.add("hidden"),m("show_result",{event_category:"Game",event_label:"Intention Show",mode:L,subsession_id:window.currentSubsessionId}),Y&&clearTimeout(Y),Y=null,B&&(B.innerHTML="",B.style.display="flex",B.classList.remove("hidden")),O&&(O.style.backgroundColor="transparent",O.classList.remove("processing")),u&&(u.classList.add("hidden"),u.classList.remove("processing")),L==="color"&&B)M.colorBlock.style.backgroundColor=V||"gray",B.appendChild(M.colorBlock);else if(L==="shape"&&B){const h=(V==="circle"?M.svgCircle:M.svgTriangle).cloneNode(!0);h.querySelectorAll("circle, polygon").forEach(c=>c.setAttribute("fill","currentColor")),B.appendChild(h)}else if(L==="sound"&&B)if(V==="sound_on"){yt();const f=M.svgOscilloscopeWave.cloneNode(!0);B.appendChild(f)}else{const f=M.svgSilenceLine.cloneNode(!0);B.appendChild(f)}const s=re.cloneNode(!0),a=s.querySelectorAll("button")[0],i=s.querySelectorAll("button")[1];O&&O.insertAdjacentElement("afterend",s),a.addEventListener("click",p),i.addEventListener("click",q);const l=window.setTimeout(()=>{if(!W)return;W=!1;const f=Date.now(),h=P?f-P:0,c=h?Math.max(.1,Number((h/1e3).toFixed(1))):.1;R.push({time:c,result:0}),le("intention"),te(),m("intention_timeout",{event_category:"Game",event_label:"Intention Timeout",mode:L,result:V,time_to_guess:c,subsession_id:window.currentSubsessionId}),n(`Intention attempt timed out, time_to_guess: ${c}s, subsession_id: ${window.currentSubsessionId}`),n("Intention attempts:",R),T()},6e4);function p(){if(!W)return;W=!1;const f=Date.now(),h=P?f-P:0,c=h?Math.max(.1,Number((h/1e3).toFixed(1))):.1;P=f,v.successes++,ee.push(1),R.push({time:c,result:1}),le("intention"),te(),m("intention_guess",{event_category:"Game",event_label:"Intention Guess",value:"success",guess_result:1,mode:L,result:V,time_to_guess:c,attempt_id:v.attempts,subsession_id:window.currentSubsessionId});const C=b?((Date.now()-b)/1e3).toFixed(1):"N/A";n(`Intention guess: Success, result: ${V}, time_to_guess: ${c}s, sequence: [${ee.join(", ")}], total game time: ${C}s, subsession_id: ${window.currentSubsessionId}`),n("Intention attempts:",R),T()}function q(){if(!W)return;W=!1;const f=Date.now(),h=P?f-P:0,c=h?Math.max(.1,Number((h/1e3).toFixed(1))):.1;P=f,v.failures++,ee.push(0),R.push({time:c,result:0}),le("intention"),te(),m("intention_guess",{event_category:"Game",event_label:"Intention Guess",value:"failure",guess_result:0,mode:L,result:V,time_to_guess:c,attempt_id:v.attempts,subsession_id:window.currentSubsessionId});const C=b?((Date.now()-b)/1e3).toFixed(1):"N/A";n(`Intention guess: Failure, result: ${V}, time_to_guess: ${c}s, sequence: [${ee.join(", ")}], total game time: ${C}s, subsession_id: ${window.currentSubsessionId}`),n("Intention attempts:",R),T()}function T(){try{clearTimeout(l),s&&s.parentNode?(s.remove(),n("Feedback buttons removed")):n("Feedback buttons not found or already removed"),B&&B.classList.add("hidden"),O&&(O.style.backgroundColor="black"),W=!1,w&&(clearTimeout(w),w=null),be==="limited"&&v.attempts>=nt?(u&&(u.disabled=!0,u.classList.add("hidden")),$||K(),_&&(n(`Scheduling New Game Button to show in ${he}ms`),_.classList.add("hidden"),w=window.setTimeout(()=>{_&&_.classList.remove("hidden"),n("New Game Button shown after delay"),w=null},he))):(V=null,u&&(u.classList.remove("hidden"),u.disabled=!1),_&&_.classList.add("hidden"),Y===null?(n("Restarting intention game from cleanupAndRestart"),Be("cleanupAndRestart")):n("Randomizer already active, skipping restart"))}catch(f){console.error("Error in cleanupAndRestart:",f),m("error",{event_category:"App",event_label:"Runtime Error",error_message:f.message,error_file:"index.tsx",subsession_id:window.currentSubsessionId})}}})},o)}function te(){Oe&&(Oe.textContent=String(v.attempts)),Ve&&(Ve.textContent=be==="limited"?String(nt):"‚àû"),We&&(We.textContent=String(v.successes)),Ue&&(Ue.textContent=String(v.failures));const e=v.attempts>0?Math.round(v.successes/v.attempts*100):0;ze&&(ze.textContent=`${e}%`);const t=R.length>0?`${R[R.length-1].time.toFixed(1)}s`:"0s";He&&(He.textContent=t);const o=A[g].success==="‚ä∏"?"‚ä∏":"‚úÖ",s=A[g].failure==="‚äπ"?"‚äπ":"‚ùå",a=R.map(l=>l.result===1?o:s).join(" ");Pe&&(Pe.textContent=a);const i=R.length?(R.reduce((l,p)=>l+p.time,0)/R.length).toFixed(1):0;je&&i!==null&&(je.textContent=`${i}s`)}function Dt(){if(n("Starting Vision shuffle"),!d||d.disabled)return;m("shuffle",{event_category:"Game",event_label:"Vision Shuffle",mode:N,subsession_id:window.currentSubsessionId}),d.disabled=!0,H(!1),r&&r.classList.add("hidden"),k&&(k.style.backgroundColor="black"),r&&(r.style.backgroundColor="transparent");const e=at+Math.random()*(At-at);Ie=window.setTimeout(()=>{F=St(N),n(`Random result generated at ${e.toFixed(2)}ms:`,F)},e),setTimeout(()=>{d&&(d.disabled=!1),H(!0),X=Date.now(),y&&(y.classList.add("active"),setTimeout(()=>y.classList.remove("active"),1e3)),n(`Choice buttons enabled at: ${X}, mode: ${N}`)},It)}function wt(){Ie!==null&&(clearTimeout(Ie),Ie=null),x&&(clearTimeout(x),x=null),d&&(d.disabled=!1),H(!1),r&&r.classList.add("hidden"),k&&(k.style.backgroundColor="black"),r&&(r.style.backgroundColor="transparent"),F=null,X=null}function H(e){if(!y)return;y.querySelectorAll(".choice-btn").forEach(o=>{o.classList.contains("hidden")?o.disabled=!0:o.disabled=!e})}function Rt(e){const t=e.target.closest(".choice-btn");if(F===null||!t||t.disabled)return;const o=t.dataset.choice;H(!1),d&&(d.disabled=!0),E.attempts++,E.attempts===1&&oe&&oe.classList.add("hidden");const s=o===F,a=s?1:0,i=Date.now(),l=X?i-X:0,p=l?Math.max(.1,Number((l/1e3).toFixed(1))):.1;X=null,Se.push(a),z.push({time:p,result:a}),le("vision");const q=b?((Date.now()-b)/1e3).toFixed(1):"N/A";if(n(`Vision guess: ${s?"Success":"Failure"}, choice: ${o}, correct: ${F}, time_to_guess: ${p}s, sequence: [${Se.join(", ")}], total game time: ${q}s`),n("Vision attempts:",z),m("guess",{event_category:"Game",event_label:"Vision Guess",value:s?"success":"failure",guess_result:a,mode:N,choice:o,correct_answer:F,time_to_guess:p,attempt_id:E.attempts,subsession_id:window.currentSubsessionId}),s?E.successes++:E.failures++,r&&r.classList.remove("hidden"),k&&(k.style.backgroundColor="transparent"),r&&(r.innerHTML="",r.style.backgroundColor="transparent"),N==="color"&&r){r.style.backgroundColor=F;let T=document.createElement("p");T.textContent=s?A[g].visionSuccess:A[g].visionFailure;const f=F;T.style.color=f==="blue"?"white":"black",T.style.textShadow="1px 1px 3px rgba(0,0,0,0.5)",r.appendChild(T),r.style.flexDirection="column",r.style.gap="0"}else if((N==="shape"||N==="sound")&&r){const T=document.createElement("div");T.classList.add("vision-feedback-content");let f;N==="shape"?f=F==="circle"?M.svgCircle.cloneNode(!0):M.svgTriangle.cloneNode(!0):F==="sound_on"?(yt(),f=M.svgOscilloscopeWave.cloneNode(!0)):f=M.svgSilenceLine.cloneNode(!0),f.querySelectorAll("circle, polygon, rect, line").forEach(c=>c.setAttribute(c.tagName==="line"?"stroke":"fill","currentColor")),T.appendChild(f);const h=document.createElement("p");h.textContent=s?A[g].visionSuccess:A[g].visionFailure,h.style.color="currentColor",T.appendChild(h),r.appendChild(T),r.style.flexDirection="row",r.style.gap="0"}de(),F=null,x&&(clearTimeout(x),x=null),setTimeout(()=>{r&&r.classList.add("hidden"),r&&(r.style.backgroundColor="transparent"),k&&(k.style.backgroundColor="black"),ve==="limited"&&E.attempts>=st?(d&&(d.disabled=!0,d.classList.add("hidden")),y&&y.classList.add("hidden"),H(!1),$||K(),I&&(I.classList.add("hidden"),x=window.setTimeout(()=>{I&&I.classList.remove("hidden"),x=null},he))):(d&&(d.disabled=!1,d.classList.remove("hidden")),y&&y.classList.remove("hidden"),H(!1),I&&I.classList.add("hidden"))},2500)}function de(){Je&&(Je.textContent=String(E.attempts)),Ke&&(Ke.textContent=ve==="limited"?String(st):"‚àû"),Ye&&(Ye.textContent=String(E.successes)),Xe&&(Xe.textContent=String(E.failures));const e=E.attempts>0?Math.round(E.successes/E.attempts*100):0;Ze&&(Ze.textContent=`${e}%`);const t=z.length>0?`${z[z.length-1].time.toFixed(1)}s`:"0s";et&&(et.textContent=t);const o=A[g].success==="‚ä∏"?"‚ä∏":"‚úÖ",s=A[g].failure==="‚äπ"?"‚äπ":"‚ùå",a=z.map(l=>l.result===1?o:s).join(" ");tt&&(tt.textContent=a);const i=z.length?(z.reduce((l,p)=>l+p.time,0)/z.length).toFixed(1):0;Qe&&i!==null&&(Qe.textContent=`${i}s`)}function Ce(){ge&&ge.forEach(e=>e.classList.add("hidden")),fe&&fe.forEach(e=>e.classList.add("hidden")),J&&J.forEach(e=>e.classList.add("hidden")),H(!1),N==="color"?ge&&ge.forEach(e=>e.classList.remove("hidden")):N==="shape"?fe&&fe.forEach(e=>e.classList.remove("hidden")):N==="sound"&&J&&J.forEach(e=>e.classList.remove("hidden"))}function Ft(){document.body.classList.toggle("light-theme");const e=document.getElementById("theme-icon"),t=document.body.classList.contains("light-theme")?"light":"dark",o=document.body.classList.contains("light-theme")?"themeDay":"themeNight",s=A[g][o];e&&(e.textContent=document.body.classList.contains("light-theme")?"‚òÄÔ∏è":"üåô");const a=document.getElementById("theme-text");a&&(a.textContent=s);const i=A[g].themeToggle;se&&se.setAttribute("aria-label",`${i}: ${s}`),m("theme_change",{event_category:"App",event_label:"Theme Toggle",value:t,theme_change:t,subsession_id:window.currentSubsessionId})}window.addEventListener("error",e=>{m("error",{event_category:"App",event_label:"Runtime Error",error_message:e.message,error_file:e.filename||"unknown",subsession_id:window.currentSubsessionId})});window.addEventListener("beforeunload",()=>{b&&!$&&(K(),le(S),m("session_end",{event_category:"App",event_label:"App Closed",session_duration_seconds:parseFloat(((Date.now()-b)/1e3).toFixed(1)),subsession_id:window.currentSubsessionId}))});document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&b&&!$&&(n("App hidden, sending session summary"),K(),m("app_background",{event_category:"App",event_label:"App Minimized",session_duration_seconds:parseFloat(((Date.now()-b)/1e3).toFixed(1)),subsession_id:window.currentSubsessionId}))});window.addEventListener("online",()=>{n("Internet connection restored, sending saved stats"),vt()});function qt(){[{id:"language-toggle-btn",element:G},{id:"language-menu",element:U},{id:"language-text",element:bt},{id:"menu-screen",element:Te},{id:"game-intention",element:Ee},{id:"game-vision",element:Le},{id:"user-greeting",element:pe}].forEach(({id:t,element:o})=>{o||console.error(`Critical element #${t} not found in DOM`)}),ae&&!ae.length&&console.error("No language options found with class .language-option")}function Gt(){if(pe=document.getElementById("user-greeting"),Te=document.getElementById("menu-screen"),ce=document.getElementById("btn-start-intention"),Ne=document.getElementById("btn-start-vision"),Q=document.getElementById("btn-read-more"),ne=document.getElementById("read-more-area"),$e=document.getElementById("btn-close-read-more"),Ee=document.getElementById("game-intention"),O=document.getElementById("intention-display"),B=document.getElementById("intention-result"),u=document.getElementById("intention-show-btn"),_=document.getElementById("intention-new-game-btn"),ie=document.getElementById("intention-attempts-mode"),ue=document.querySelectorAll('input[name="intention-mode"]'),ke=document.querySelectorAll('input[name="intention-attempts-mode"]'),Oe=document.getElementById("intention-stats-attempts"),Ve=document.getElementById("intention-stats-max-attempts"),We=document.getElementById("intention-stats-successes"),Ue=document.getElementById("intention-stats-failures"),ze=document.getElementById("intention-stats-success-rate"),je=document.getElementById("intention-stats-avg-time"),He=document.getElementById("intention-stats-last-attempt-time"),Pe=document.getElementById("intention-stats-history"),Le=document.getElementById("game-vision"),d=document.getElementById("vision-shuffle-btn"),k=document.getElementById("vision-display"),r=document.getElementById("vision-result"),y=document.getElementById("vision-choices"),I=document.getElementById("vision-new-game-btn"),oe=document.getElementById("vision-attempts-mode"),ge=document.querySelectorAll("#vision-choices .color-btn"),fe=document.querySelectorAll("#vision-choices .shape-btn"),J=document.querySelectorAll("#vision-choices .sound-btn"),Je=document.getElementById("stats-attempts"),Ke=document.getElementById("stats-max-attempts"),Ye=document.getElementById("stats-successes"),Xe=document.getElementById("stats-failures"),Ze=document.getElementById("stats-success-rate"),Qe=document.getElementById("stats-avg-time"),et=document.getElementById("vision-stats-last-attempt-time"),tt=document.getElementById("vision-stats-history"),De=document.querySelectorAll('input[name="vision-mode"]'),Re=document.querySelectorAll('input[name="vision-attempts-mode"]'),Fe=document.querySelectorAll(".back-btn"),se=document.getElementById("theme-toggle-btn"),G=document.getElementById("language-toggle-btn"),U=document.getElementById("language-menu"),ae=document.querySelectorAll(".language-option"),bt=document.getElementById("language-text"),Mt(),qt(),se&&se.addEventListener("click",Ft),G&&U&&ae&&ae.length&&(G.addEventListener("click",()=>{const i=U.classList.toggle("hidden");G.setAttribute("aria-expanded",String(!i)),n(`Language menu ${i?"hidden":"shown"}`)}),ae.forEach(i=>{i.addEventListener("click",()=>{const l=i.dataset.lang;if(!l)return;const p=l;if(p===g){U.classList.add("hidden"),G.setAttribute("aria-expanded","false");return}g=p,rt(),U.classList.add("hidden"),G.setAttribute("aria-expanded","false"),m("language_change",{event_category:"App",event_label:"Language Change",value:g,subsession_id:window.currentSubsessionId}),n(`Language changed to: ${g}`)}),i.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),l.target.click())})}),document.addEventListener("click",i=>{G&&U&&!G.contains(i.target)&&!U.contains(i.target)&&(U.classList.add("hidden"),G.setAttribute("aria-expanded","false"))})),ce&&ce.addEventListener("click",()=>{b=Date.now(),$=!1,ft(),we("game-intention"),setTimeout(()=>{m("game_select",{event_category:"Game",event_label:"Intention",game_mode:L,subsession_id:window.currentSubsessionId,event_timestamp_ms:Date.now(),timezone_offset:new Date().getTimezoneOffset()})},0)}),Ne&&Ne.addEventListener("click",()=>{b=Date.now(),$=!1,pt(),we("game-vision"),setTimeout(()=>{m("game_select",{event_category:"Game",event_label:"Vision",game_mode:N,subsession_id:window.currentSubsessionId,event_timestamp_ms:Date.now(),timezone_offset:new Date().getTimezoneOffset()})},0)}),Q&&Q.addEventListener("click",()=>{ne&&ne.classList.remove("hidden"),Q.classList.add("hidden"),m("read_more",{event_category:"App",event_label:"Read More Clicked",subsession_id:window.currentSubsessionId})}),$e&&$e.addEventListener("click",()=>{ne&&ne.classList.add("hidden"),Q&&Q.classList.remove("hidden")}),Fe&&Fe.forEach(i=>{i.addEventListener("click",()=>{if(b&&!$){const l=((Date.now()-b)/1e3).toFixed(1);m("game_exit",{event_category:"Game",event_label:S==="intention"?"Intention":"Vision",game_mode:S==="intention"?L:N,session_duration_seconds:parseFloat(l),subsession_id:window.currentSubsessionId}),K()}we("menu-screen")})}),u&&u.addEventListener("click",kt),O&&O.addEventListener("click",()=>{u&&!u.classList.contains("hidden")&&!u.disabled&&S==="intention"&&!W?(n("Intention display clicked, triggering show result"),m("display_click",{event_category:"Game",event_label:"Intention Display",subsession_id:window.currentSubsessionId}),u.click()):n("Intention display click ignored:",{showBtnHidden:u?u.classList.contains("hidden"):"N/A",showBtnDisabled:u?u.disabled:"N/A",gameMode:S,isProcessing:W})}),ue&&!ue.length?console.error("No radio buttons found for intention-mode"):ue&&ue.forEach(i=>{i.addEventListener("change",l=>{v.attempts>0&&!$&&b&&K(),L=l.target.value,L==="sound"&&(j||xe(Ae)),m("mode_change",{event_category:"Game",event_label:"Intention Mode",value:L,subsession_id:window.currentSubsessionId}),Me(),w&&(clearTimeout(w),w=null),_&&_.classList.add("hidden"),Be("modeChange")})}),ke&&ke.forEach(i=>{i.addEventListener("change",l=>{be=l.target.value,te(),w&&(clearTimeout(w),w=null),be==="limited"&&v.attempts>=nt?(u&&(u.disabled=!0,u.classList.add("hidden")),_&&(_.classList.add("hidden"),w=window.setTimeout(()=>{_&&_.classList.remove("hidden"),w=null},he))):(u&&(W||(u.disabled=!1,u.classList.remove("hidden"))),_&&_.classList.add("hidden"))})}),_&&_.addEventListener("click",()=>{n("New Game Button Clicked"),ft()}),d&&d.addEventListener("click",Dt),k&&k.addEventListener("click",()=>{d&&!d.disabled&&S==="vision"&&(m("display_click",{event_category:"Game",event_label:"Vision Display",subsession_id:window.currentSubsessionId}),d.click())}),y&&y.addEventListener("click",Rt),De&&De.forEach(i=>{i.addEventListener("click",l=>{E.attempts>0&&!$&&b&&K(),N=l.target.value,N==="sound"&&!j&&xe(Ae),ye(),m("mode_change",{event_category:"Game",event_label:"Vision Mode",value:N,subsession_id:window.currentSubsessionId}),Ce(),H(!1),d&&(d.disabled=!1,d.classList.remove("hidden")),y&&y.classList.remove("hidden"),r&&r.classList.add("hidden"),k&&(k.style.backgroundColor="black"),r&&(r.style.backgroundColor="transparent"),F=null,X=null,x&&(clearTimeout(x),x=null),I&&I.classList.add("hidden")})}),Re&&Re.forEach(i=>{i.addEventListener("change",l=>{ve=l.target.value,de(),x&&(clearTimeout(x),x=null),ve==="limited"&&E.attempts>=st?(d&&(d.disabled=!0,d.classList.add("hidden")),y&&y.classList.add("hidden"),H(!1),I&&(I.classList.add("hidden"),x=window.setTimeout(()=>{I&&I.classList.remove("hidden"),x=null},he))):(d&&(d.disabled=!1,d.classList.remove("hidden")),y&&y.classList.remove("hidden"),H(!1),I&&I.classList.add("hidden"))})}),I&&I.addEventListener("click",pt),typeof Telegram<"u"&&Telegram.WebApp){Telegram.WebApp.MainButton.onClick(()=>{b&&!$&&(n("MainButton clicked, sending session summary"),K(),m("app_close",{event_category:"App",event_label:"MainButton Close",session_duration_seconds:parseFloat(((Date.now()-b)/1e3).toFixed(1)),subsession_id:window.currentSubsessionId})),typeof Telegram<"u"&&Telegram.WebApp&&Telegram.WebApp.close()});try{Telegram.WebApp.ready(),Telegram.WebApp.expand();const i=document.getElementById("telegram-user-name");Telegram.WebApp.initDataUnsafe&&Telegram.WebApp.initDataUnsafe.user?(D=Telegram.WebApp.initDataUnsafe.user,window.userId=String(D.id),i&&(i.textContent=D.first_name??A[g].defaultUserName),n("Telegram User:",{id:D.id,first_name:D.first_name}),typeof gtag=="function"&&gtag("set","user_properties",{custom_user_id:window.userId}),m("app_launch",{event_category:"App",event_label:"Mini App Started",start_param:Telegram.WebApp.initDataUnsafe.start_param||"none",subsession_id:window.currentSubsessionId})):(D={id:parseInt(window.userId.replace("anonymous_",""),36)||Date.now(),first_name:A[g].defaultUserName},i&&(i.textContent=D.first_name??null),n("Anonymous User:",{id:window.userId}),typeof gtag=="function"&&gtag("set","user_properties",{custom_user_id:window.userId}),m("app_launch",{event_category:"App",event_label:"Mini App Started (No User)",start_param:Telegram.WebApp.initDataUnsafe&&Telegram.WebApp.initDataUnsafe.start_param||"none",subsession_id:window.currentSubsessionId}))}catch(i){console.warn("Telegram WebApp not available, using anonymous user. Error:",i);const l=document.getElementById("telegram-user-name");D={id:parseInt(window.userId.replace("anonymous_",""),36)||Date.now(),first_name:A[g].defaultUserName},l&&(l.textContent=D.first_name??null),typeof gtag=="function"&&gtag("set","user_properties",{custom_user_id:window.userId}),m("app_launch",{event_category:"App",event_label:"Mini App Started (No User)",start_param:"none",subsession_id:window.currentSubsessionId})}}else{console.warn("Telegram WebApp SDK not found.");const i=document.getElementById("telegram-user-name");D={id:parseInt(window.userId.replace("anonymous_",""),36)||Date.now(),first_name:A[g].defaultUserName},i&&(i.textContent=D.first_name??null),typeof gtag=="function"&&gtag("set","user_properties",{custom_user_id:window.userId}),m("app_launch",{event_category:"App",event_label:"Mini App Started (SDK Not Found)",start_param:"none",subsession_id:window.currentSubsessionId})}U&&(U.classList.add("hidden"),G&&G.setAttribute("aria-expanded","false")),n("Current body classes for theme:",document.body.className),rt(),we("menu-screen"),Ce();const e=document.body.classList.contains("light-theme")?"themeDay":"themeNight",t=A[g][e],o=document.getElementById("theme-icon");o&&(o.textContent=document.body.classList.contains("light-theme")?"‚òÄÔ∏è":"üåô");const s=document.getElementById("theme-text");s&&(s.textContent=t);const a=A[g].themeToggle;se&&se.setAttribute("aria-label",`${a}: ${t}`),m("app_initialized",{event_category:"App",event_label:"App Fully Initialized",language:g,theme:document.body.classList.contains("light-theme")?"light":"dark",subsession_id:window.currentSubsessionId}),["intentionAttempts","visionAttempts"].forEach(i=>{const l=localStorage.getItem(i);if(l)try{const p=JSON.parse(l);Array.isArray(p)&&(n(`Found ${p.length} saved ${i} in localStorage`),i==="intentionAttempts"?(R.push(...p),te()):(z.push(...p),de()))}catch(p){console.error(`Error parsing ${i} from localStorage:`,p);try{localStorage.removeItem(i)}catch(q){console.error(`Failed to remove corrupted ${i}`,q)}}}),ce&&ce.focus(),n("App fully initialized",{language:g,theme:document.body.classList.contains("light-theme")?"light":"dark",subsessionId:window.currentSubsessionId})}document.addEventListener("DOMContentLoaded",()=>{Gt(),vt()});
